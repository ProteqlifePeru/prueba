<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìû Dashboard Llamadas 107 - ESSALUD</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/a2d04b6a6a.js" crossorigin="anonymous"></script>
<style>
:root {
  --primary: #0066cc;
  --secondary: #00a859;
  --accent: #e7f1ff;
  --bg: linear-gradient(135deg,#d0e7ff,#f0f9ff);
  --text: #222;
  --card-bg: #fff;
  --radius: 16px;
  --shadow: 0 12px 40px rgba(0,0,0,0.15);
}
* {box-sizing:border-box;}
body {
  font-family:'Poppins',sans-serif;
  margin:0; padding:0;
  background: var(--bg);
  display:flex; justify-content:center; min-height:100vh;
}
.container {
  width: 80%;
  max-width: 1000px;
  margin: 40px auto;
  padding: 20px;
}
h1 {
  text-align:center;
  color: var(--primary);
  font-size:28px;
  font-weight:700;
  margin-bottom:30px;
  text-shadow:1px 1px 2px rgba(0,0,0,0.1);
}
.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:20px 25px;
  margin-bottom:25px;
  transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover {transform: translateY(-5px); box-shadow:0 20px 50px rgba(0,0,0,0.25);}
.section-title {
  margin-top:20px;
  margin-bottom:10px;
  font-size:20px;
  font-weight:600;
  color: var(--primary);
  border-left:5px solid var(--primary);
  padding-left:10px;
  display:flex; align-items:center; gap:8px;
}
label {display:block; margin-top:12px; font-weight:500; font-size:14px;}
input, select {
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
  transition:0.3s;
}
input:focus, select:focus {
  outline:none; border-color: var(--primary);
  box-shadow:0 0 8px rgba(0,102,204,0.3);
  background: var(--accent);
}
input[readonly], select[readonly] {background:#f0f0f0;}
#nombreCompleto {
  font-size:20px;
  font-weight:700;
  color:#000;
  text-align:center;
  border:2px solid #ccc;
  border-radius:14px;
  padding:10px;
  transition:0.3s;
}
.flex {display:flex; gap:15px; flex-wrap:wrap;}
.flex-2 > div, .flex-3 > div {flex:1;}
.flex-3 > div {min-width:150px;}
button {
  padding:12px;
  background: var(--secondary);
  color:white;
  border:none;
  border-radius:14px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:0.3s;
}
button:hover {
  transform: translateY(-2px);
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
}
#btnLimpiar, #btnCerrarSesion {background:#cc0000;}
#btnLimpiar:hover, #btnCerrarSesion:hover {background:#990000;}
#mensajeDNI {
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background: #d0e7ff;
  color: #0066cc;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 14px;
  margin-top: 5px;
  display: none;
  text-align: center;
  border: 1px solid #b0dbff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  z-index: 10;
}
#mensajeDNI.error {
  background: #f8d7da;
  color: #721c24;
  border-color: #f5c6cb;
}
#mensajeDNI.success {
  background: #d0f2e0;
  color: #155724;
  border-color: #c3e6cb;
}
#motivoOtro {
  width:100%; padding:10px 12px; border-radius:12px;
  margin-top:8px; font-size:14px;
  display:none;
  border:1px solid #ff9800; background:#fff8e1; color:#e65100;
  box-shadow:0 0 6px rgba(255,152,0,0.2);
}
</style>
</head>
<body>
<div class="container">
  <button id="btnCerrarSesion" style="margin-bottom:15px; display:none;">
    <i class="fas fa-sign-out-alt"></i> Cerrar sesi√≥n
  </button>

  <h1><i class="fas fa-phone-volume"></i> Dashboard Llamadas 107 - ESSALUD</h1>
  <div class="card">
    <div id="contadorDuracion"></div>

    <div class="section-title"><i class="fas fa-clock"></i> Fecha y hora de inicio</div>
    <input type="text" id="fechaInicio" readonly style="
      width:100%; padding:10px 12px; border-radius:12px;
      background:#f0f0f0; color:#333; font-weight:500;
      text-align:center; letter-spacing:0.5px;
    ">

    <div class="section-title"><i class="fas fa-user-md"></i> Datos del Profesional</div>
    <div class="flex flex-2">
      <div>
        <label>Profesi√≥n</label>
        <input type="text" id="profesion" readonly style="background:#f0f0f0; color:#333; font-weight:500;">
      </div>
      <div>
        <label>Personal</label>
        <select id="personal">
          <option value="">Seleccione...</option>
        </select>
      </div>
    </div>

    <div class="section-title"><i class="fas fa-phone"></i> Datos de la Llamada</div>
    <label>Opciones de llamada üìû</label>
    <select id="opcionLlamada">
      <option value="">Seleccione...</option>
      <option>Opci√≥n 0 - Informaci√≥n sobre vacunaci√≥n</option>
      <option>Opci√≥n 1 - Informaci√≥n medicina general</option>
      <option>Opci√≥n 2 - L√≠nea del paciente cr√≥nico</option>
      <option>Opci√≥n 3 - Informaci√≥n en psicolog√≠a</option>
      <option>Opci√≥n 4 - Asesor√≠a en nutrici√≥n</option>
      <option>Opci√≥n 5 - Enfermedades varias</option>
      <option>Opci√≥n 6 - Casos de violencia contra la mujer</option>
      <option>Opci√≥n 7 - Atenci√≥n a personas vulnerables</option>
      <option>Opci√≥n 8 - L√≠nea del donante</option>
      <option>Opci√≥n 9 - Oncol√≠nea ESSALUD</option>
      <option>LLAMADAS MAL INTENCIONADAS</option>
    </select>
    <label>N√∫mero de tel√©fono üì±</label>
    <input type="tel" id="telefono" placeholder="Ej. 987654321">

    <div class="section-title"><i class="fas fa-sticky-note"></i> Motivo de la llamada</div>
    <select id="motivoLlamada" style="width:100%; padding:10px 12px; border-radius:12px; border:1px solid #ccc; font-size:14px;">
      <option value="">Seleccione el motivo...</option>
      <option>ALTERACION DE LA COMPOSICION MASA CORPORAL</option>
      <option>ALTERACIONES DE LA GLUCOSA</option>
      <option>ALTERACIONES DE LA PIEL Y FANERAS</option>
      <option>ALTERACIONES DE LA TIROIDES</option>
      <option>ALTERACIONES DE LA VISI√ìN</option>
      <option>ALTERACIONES EN EL O√çDO</option>
      <option>ALTERACIONES EN LA PIEL</option>
      <option>MOLESTIAS URINARIAS</option>
      <option>ANEMIA</option>
      <option>AYUDA AL DIAGNOSTICO</option>
      <option>CONSULTAS RELACIONADOS AL EMBARAZO</option>
      <option>CRECIMIENTO Y DESARROLLO O NI√ëO SANO</option>
      <option>DEMENCIAS</option>
      <option>DISCAPACIDAD</option>
      <option>DISMINUCI√ìN DE LA AGUDEZA VISUAL</option>
      <option>DOLOR DE CABEZA</option>
      <option>DOLOR LUMBAR</option>
      <option>FIEBRE</option>
      <option>HIPOACUSIA</option>
      <option>INFORMACI√ìN SOBRE TEMAS ADMINISTRATIVOS</option>
      <option>MORDEDURAS O PICADURAS DE ANIMALES</option>
      <option>OTROS PROBLEMAS CARDIOVASCULARES</option>
      <option>P. RELACIONADOS CON ALTERACIONES PSICOLOGICAS</option>
      <option>P. RELACIONADOS CON FACTORES PROTECTORES Y/O DE RIESGOS</option>
      <option>P. RELACIONADOS CON VIOLENCIA</option>
      <option>PATOLOGIAS MUSCULOESQUELETICAS</option>
      <option>PLANIFICACION FAMILIAR</option>
      <option>PRESENCIA DE CUERPO EXTRA√ëO</option>
      <option>PRESI√ìN ARTERIAL DISMINUIDA (HIPOTENSI√ìN)</option>
      <option>PRESION ARTERIAL ELEVADA</option>
      <option>PREVENCION Y PROMOCION EN SALUD</option>
      <option>PROBLEMAS ODONTOLOGICOS</option>
      <option>REACCIONES AL√âRGICAS LEVES</option>
      <option>SECRECION CONJUNTIVAL</option>
      <option>SINTOMAS GASTROINTESTINALES</option>
      <option>SINTOMAS RESPIRATORIOS</option>
      <option>TRASTORNOS DEL AFECTO</option>
      <option>TRAUMATISMO SIN PERDIDA DE MOVILIDAD</option>
      <option>VACUNACI√ìN</option>
      <option>VERTIGO O MAREOS SIN TRAUMA PREVIO</option>
      <option>OTROS</option>
    </select>
    <input type="text" id="motivoOtro" placeholder="Especifique el motivo..." />

    <div class="section-title"><i class="fas fa-user"></i> Datos del Paciente</div>
    <div class="flex flex-2">
      <div>
        <label>Tipo de documento üÜî</label>
        <select id="tipoDoc">
          <option value="DNI" selected>DNI</option>
          <option>CE</option>
          <option>PASS</option>
          <option>C√âDULA</option>
          <option>AN√ìNIMO</option>
        </select>
      </div>
      <div style="position:relative; width:100%;">
        <label>N¬∞ Documento</label>
        <input type="text" id="dni" maxlength="12" placeholder="Ingrese el n√∫mero">
        <div id="mensajeDNI">
          <i class="fas fa-info-circle" style="margin-right:5px;"></i>
          <span id="mensajeDNITexto"></span>
        </div>
      </div>
    </div>
    <label>Nombre completo üë§</label>
    <input type="text" id="nombreCompleto" readonly>
    <div class="flex flex-2">
      <div>
        <label>Sexo</label>
        <select id="sexo" readonly>
          <option value="">Seleccione...</option>
          <option>M</option>
          <option>F</option>
        </select>
      </div>
      <div>
        <label>Fecha de nacimiento üìÖ</label>
        <input type="date" id="fechaNac" readonly>
      </div>
    </div>
    <label>Edad actual üßÆ</label>
    <input type="text" id="edad" readonly>

    <div class="section-title"><i class="fas fa-map-marker-alt"></i> Ubicaci√≥n üó∫Ô∏è</div>
    <div class="flex flex-3">
      <div>
        <label>Departamento</label>
        <select id="departamento">
          <option value="">Seleccione...</option>
        </select>
      </div>
      <div>
        <label>Provincia</label>
        <select id="provincia">
          <option value="">Seleccione...</option>
        </select>
      </div>
      <div>
        <label>Distrito</label>
        <select id="distrito">
          <option value="">Seleccione...</option>
        </select>
      </div>
    </div>

    <label>Fecha y hora de t√©rmino ‚è∞</label>
    <input type="text" id="fechaTermino" readonly>
    <div class="flex" style="gap:10px; margin-top:20px;">
      <button id="btnGuardar"><i class="fas fa-save"></i> Guardar Registro</button>
      <button id="btnLimpiar"><i class="fas fa-eraser"></i> Limpiar Todo</button>
    </div>
  </div>
</div>

<script>
// ---------- Referencias ----------
const $ = s => document.querySelector(s);
const el = {
  dni: $('#dni'),
  nombreCompleto: $('#nombreCompleto'),
  sexo: $('#sexo'),
  fechaNac: $('#fechaNac'),
  edad: $('#edad'),
  departamento: $('#departamento'),
  provincia: $('#provincia'),
  distrito: $('#distrito'),
  profesion: $('#profesion'),
  personal: $('#personal'),
  opcionLlamada: $('#opcionLlamada'),
  telefono: $('#telefono'),
  tipoDoc: $('#tipoDoc'),
  motivoLlamada: $('#motivoLlamada'),
  motivoOtro: $('#motivoOtro'),
  btnGuardar: $('#btnGuardar'),
  btnLimpiar: $('#btnLimpiar'),
  btnCerrarSesion: $('#btnCerrarSesion'),
  mensajeDNI: $('#mensajeDNI'),
  mensajeDNITexto: $('#mensajeDNITexto'),
  contadorDuracion: $('#contadorDuracion'),
  fechaInicio: $('#fechaInicio'),
  fechaTermino: $('#fechaTermino')
};

// ---------- Fecha de inicio ----------
function formatoFecha(f){
  const d = String(f.getDate()).padStart(2,'0');
  const m = String(f.getMonth()+1).padStart(2,'0');
  const y = f.getFullYear();
  const h = String(f.getHours()).padStart(2,'0');
  const min = String(f.getMinutes()).padStart(2,'0');
  const s = String(f.getSeconds()).padStart(2,'0');
  return `${d}_${m}_${y} ${h}:${min}:${s}`;
}

if (el.fechaInicio) {
  el.fechaInicio.value = formatoFecha(new Date());
}

// ---------- Contador ----------
let inicioLlamada = new Date();
function actualizarContador(){
  const ahora = new Date();
  let diff = Math.floor((ahora - inicioLlamada) / 1000);
  const h = String(Math.floor(diff / 3600)).padStart(2,'0');
  diff %= 3600;
  const m = String(Math.floor(diff / 60)).padStart(2,'0');
  const s = String(diff % 60).padStart(2,'0');
  el.contadorDuracion.textContent = `‚è±Ô∏è Duraci√≥n de la llamada: ${h}:${m}:${s}`;
}
setInterval(actualizarContador, 1000);

// ---------- Personal ‚Üí Profesi√≥n ----------
const personalLista = {
  "ALBITRES VIDAL RODRIGO": "PSICOLOG√çA",
  "ALMONACIN MALLQUI JASMIN": "PSICOLOG√çA",
  "ALVARON PEREZ GREETEL VANESSA": "ENFERMER√çA",
  "ANCO SOLORZANO CINDY": "ENFERMER√çA",
  "ARANDA MARENGO MAR√çA ISABEL": "ENFERMER√çA",
  "ARROYO JARA ALESSANDRA": "NUTRICIONISTA",
  "AYALA HUA√ëA EDITH": "OBSTETRICIA",
  "BENITES MORENO HENRY": "NUTRICIONISTA",
  "BERNABE ORELLANO PAULA MAR√çA": "ENFERMER√çA",
  "CALDERON CAHUANTICO LUCY MELISA": "NUTRICIONISTA",
  "CARDENAS KRAPP ZARELA LUCIEN": "MEDICINA",
  "CASTILLO ROMERO CARLA": "PSICOLOG√çA",
  "CAYLLAHUA QUISPE YAKELIN": "PSICOLOG√çA",
  "CUBAS JARA MILAGROS MALLENA": "MEDICINA",
  "CUSTODIO SALAZAR LENIN RUBEN": "ENFERMER√çA",
  "DEL CASTILLO BARRIENTOS MILAGROS DEL ROCIO": "PSICOLOG√çA",
  "ECOS RAMOS FANNY LOURDES": "ENFERMER√çA",
  "ESPINOZA SALCEDO NANCY": "OBSTETRICIA",
  "FERNANDEZ HUARHUACHI YURINA": "MEDICINA",
  "GALVEZ CALVO ALESSANDRA ISABEL INES": "OBSTETRICIA",
  "GOMEZ MARIN ALICIA PATRICIA": "OBSTETRICIA",
  "GUARDAMINO GUILLEN MARIELA DEYSI": "ENFERMER√çA",
  "GUTARRA MENDEZ ARTURO ENRIQUE": "PSICOLOG√çA",
  "HERQUINIO VEGA CARMEN ROCIO": "ENFERMER√çA",
  "HINOSTROZA YARASCA EDER": "ENFERMER√çA",
  "HORNA QUEVEDO GUILIANA": "PSICOLOG√çA",
  "IGNACIO ESPINOZA KATHERINE": "OBSTETRICIA",
  "LAPA PEREZ NURIA GENOVEVA": "ASISTENTE SOCIAL",
  "LAVALLE LESCANO ELIANA": "OBSTETRICIA",
  "LAZO MONTOYA YESSENIA": "NUTRICIONISTA",
  "MENDOZA GIRALDO JESARELA JEZIEL": "OBSTETRICIA",
  "MU√ëOZ BARRIOS ANNGIE DEL ROSARIO": "ENFERMER√çA",
  "OLIVARES MENDOZA ROSA INES": "MEDICINA",
  "PAREDES CASTILLO LUBY EDITA": "OBSTETRICIA",
  "RIVERA CORDOVA XIMENA CLAUDIA": "PSICOLOG√çA",
  "ROBLES ALFARO RICARDO ALESSANDRO": "MEDICINA",
  "SALAZAR CUEVA EVELYN": "NUTRICIONISTA",
  "SALINAS BOGGIO RAM": "MEDICINA",
  "SALVADOR CALZADA JESSICA": "ENFERMER√çA",
  "VITE CELEDONIO MARIA": "ENFERMER√çA",
  "YPANAQU√â CELIS, CINTHYA LAURA": "OBSTETRICIA",
  "ZEGARRA DE LAMA MAGALY REINELIA": "PSICOLOG√çA",
  "ZU√ëIGA SANCHEZ SANDRA": "PSICOLOG√çA"
};

Object.keys(personalLista).forEach(nombre => {
  const opt = document.createElement('option');
  opt.value = nombre;
  opt.textContent = nombre;
  el.personal.appendChild(opt);
});

el.personal.addEventListener('change', () => {
  const nombre = el.personal.value;
  el.profesion.value = personalLista[nombre] || '';
  if (nombre && personalLista[nombre]) {
    localStorage.setItem('usuarioActivo', nombre);
    el.personal.disabled = true;
    el.profesion.style.background = '#e7f1ff';
    el.btnCerrarSesion.style.display = 'inline-block';
  } else {
    localStorage.removeItem('usuarioActivo');
    el.profesion.value = '';
    el.personal.disabled = false;
    el.profesion.style.background = '#f0f0f0';
    el.btnCerrarSesion.style.display = 'none';
  }
});

window.addEventListener('load', () => {
  const nombre = localStorage.getItem('usuarioActivo');
  if (nombre && personalLista[nombre]) {
    el.personal.value = nombre;
    el.profesion.value = personalLista[nombre];
    el.personal.disabled = true;
    el.profesion.style.background = '#e7f1ff';
    el.btnCerrarSesion.style.display = 'inline-block';
  }
});

el.btnCerrarSesion.addEventListener('click', () => {
  localStorage.removeItem('usuarioActivo');
  el.personal.value = '';
  el.profesion.value = '';
  el.personal.disabled = false;
  el.profesion.style.background = '#f0f0f0';
  el.btnCerrarSesion.style.display = 'none';
  inicioLlamada = new Date();
});

// ---------- Motivo de llamada condicional ----------
el.motivoLlamada.addEventListener('change', () => {
  if (el.motivoLlamada.value === 'OTROS') {
    el.motivoOtro.style.display = 'block';
    el.motivoOtro.focus();
  } else {
    el.motivoOtro.style.display = 'none';
    el.motivoOtro.value = '';
  }
});

// ---------- DNI con mensaje localizado ----------
let debounceTimer;
el.dni.addEventListener('input', e => {
  const dni = e.target.value.trim();
  clearTimeout(debounceTimer);
  if (dni.length >= 8) {
    debounceTimer = setTimeout(() => buscarDNI(dni), 500);
  }
});

function mostrarMensajeDNI(texto, tipo = 'info') {
  el.mensajeDNITexto.textContent = texto;
  el.mensajeDNI.className = '';
  el.mensajeDNI.classList.add(tipo);
  el.mensajeDNI.style.display = 'block';
  setTimeout(() => {
    el.mensajeDNI.style.display = 'none';
  }, 5000);
}

// ---------- API (SIN CAMBIOS) ----------
async function buscarDNI(dni){
  const urls = [`http://172.20.60.152:8000/buscar/${dni}`];
  let data = null;
  for(const url of urls){
    try{
      const res = await fetch(url);
      if(res.ok){
        data = await res.json();
        mostrarMensajeDNI(`‚úÖ Conectado: ${url}`, 'success');
        break;
      }
    }catch(e){}
  }
  if(data && (data.DNI || data.dni)){
    el.nombreCompleto.value = data.NOMBRE_COMPLETO || data.nombre_completo || '';
    el.nombreCompleto.style.background = '#d0f2e0';
    el.sexo.value = data.SEXO || data.sexo || '';
    let fechaServer = data.FECHA_NAC || data.fecha_nacimiento || '';
    if(fechaServer){
      let parts = fechaServer.split(/[-/_]/);
      if(parts.length===3){
        let day = parts[0].padStart(2,'0');
        let month = parts[1].padStart(2,'0');
        let year = parts[2];
        el.fechaNac.value = `${year}-${month}-${day}`;
      }
    }
    calcularEdad();
  } else {
    mostrarMensajeDNI('‚ö†Ô∏è No se encontr√≥ el DNI. Complete los datos manualmente.', 'error');
    el.nombreCompleto.value = '';
    el.nombreCompleto.style.background = '#f8d7da';
    el.nombreCompleto.removeAttribute('readonly');
    el.fechaNac.removeAttribute('readonly');
    el.sexo.removeAttribute('readonly');
  }
}

// ---------- Edad ----------
el.fechaNac.addEventListener('change', calcularEdad);
function calcularEdad(){
  const fechaNac = new Date(el.fechaNac.value);
  if(isNaN(fechaNac)) return;
  const hoy = new Date();
  let a√±os = hoy.getFullYear() - fechaNac.getFullYear();
  let meses = hoy.getMonth() - fechaNac.getMonth();
  let dias = hoy.getDate() - fechaNac.getDate();
  if(dias<0){ meses--; const mesAnt = new Date(hoy.getFullYear(), hoy.getMonth(),0); dias+=mesAnt.getDate();}
  if(meses<0){a√±os--;meses+=12;}
  el.edad.value = `${a√±os} a√±os, ${meses} meses, ${dias} d√≠as`;
}

// ---------- Guardar ----------
el.btnGuardar.addEventListener('click', () => {
  const campos = [
    {id:'profesion', nombre:'Profesi√≥n'},
    {id:'personal', nombre:'Personal'},
    {id:'opcionLlamada', nombre:'Opci√≥n de llamada'},
    {id:'telefono', nombre:'Tel√©fono'},
    {id:'tipoDoc', nombre:'Tipo de documento'},
    {id:'dni', nombre:'N√∫mero de documento'},
    {id:'nombreCompleto', nombre:'Nombre completo'},
    {id:'sexo', nombre:'Sexo'},
    {id:'fechaNac', nombre:'Fecha de nacimiento'},
    {id:'departamento', nombre:'Departamento'},
    {id:'provincia', nombre:'Provincia'},
    {id:'distrito', nombre:'Distrito'},
    {id:'motivoLlamada', nombre:'Motivo de la llamada'}
  ];

  for (const c of campos) {
    if (!document.getElementById(c.id).value.trim()) {
      alert(`‚ùå Complete: ${c.nombre}`);
      return;
    }
  }

  if (el.motivoLlamada.value === 'OTROS') {
    const otro = el.motivoOtro.value.trim();
    if (!otro) {
      alert('‚ùå Especifique el motivo en "OTROS"');
      el.motivoOtro.focus();
      return;
    }
  }

  el.fechaTermino.value = formatoFecha(new Date());
  alert('‚úÖ Registro guardado correctamente.');
});

// ---------- Limpiar ----------
el.btnLimpiar.addEventListener('click',()=>{
  document.querySelectorAll('input').forEach(i=>i.value='');
  document.querySelectorAll('select').forEach(s=>s.selectedIndex = 0);
  el.nombreCompleto.style.background='#fff';
  el.mensajeDNI.style.display = 'none';
  el.motivoOtro.style.display = 'none';
  inicioLlamada = new Date();
});

// ---------- Ubigeos (MUESTREO M√çNIMO) ----------
const ubigeos = {
  "LIMA": {"provincias":["Lima","Barranca"],"distritos":{"Lima":["Lima","San Isidro","Miraflores"],"Barranca":["Barranca","Supe"]}},
  "CALLAO": {"provincias":["Callao"],"distritos":{"Callao":["Callao","Bellavista","La Punta"]}},
  "AREQUIPA": {"provincias":["Arequipa"],"distritos":{"Arequipa":["Arequipa","Cayma","Yanahuara"]}}
};

Object.keys(ubigeos).forEach(depto => {
  const opt = document.createElement('option');
  opt.value = depto;
  opt.textContent = depto;
  el.departamento.appendChild(opt);
});

el.departamento.addEventListener('change', () => {
  el.provincia.innerHTML = '<option value="">Seleccione...</option>';
  el.distrito.innerHTML = '<option value="">Seleccione...</option>';
  const depto = ubigeos[el.departamento.value];
  if (!depto) return;
  el.provincia.innerHTML = '<option value="">Seleccione...</option>' +
    depto.provincias.map(p => `<option value="${p}">${p}</option>`).join('');
});

el.provincia.addEventListener('change', () => {
  el.distrito.innerHTML = '<option value="">Seleccione...</option>';
  const dists = ubigeos[el.departamento.value]?.distritos?.[el.provincia.value] || [];
  el.distrito.innerHTML = '<option value="">Seleccione...</option>' +
    dists.map(d => `<option value="${d}">${d}</option>`).join('');
});
</script>
</body>
</html>
